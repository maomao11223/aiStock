From 98798f933cf28cc267f7430890d31cb1c173bee3 Mon Sep 17 00:00:00 2001
From: amao <86212616+maomao11223@users.noreply.github.com>
Date: Wed, 9 Apr 2025 17:06:37 +0800
Subject: [PATCH 4/4] =?UTF-8?q?[feature]=E5=A2=9E=E5=8A=A0=E7=88=AC?=
 =?UTF-8?q?=E8=9F=B2?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 pom.xml                                       |  6 +++
 .../com/example/demo/config/WebConfig.java    | 19 ++++++++
 .../com/example/demo/crawler/NewsDto.java     | 14 ++++++
 .../demo/crawler/YahooNewsCrawler.java        | 48 +++++++++++++++++++
 .../demo/crawler/YahooNewsCrawlerTest.java    | 27 +++++++++++
 5 files changed, 114 insertions(+)
 create mode 100644 src/main/java/com/example/demo/config/WebConfig.java
 create mode 100644 src/main/java/com/example/demo/crawler/NewsDto.java
 create mode 100644 src/main/java/com/example/demo/crawler/YahooNewsCrawler.java
 create mode 100644 src/test/java/com/example/demo/crawler/YahooNewsCrawlerTest.java

diff --git a/pom.xml b/pom.xml
index 6df1112..776eb80 100644
--- a/pom.xml
+++ b/pom.xml
@@ -88,6 +88,12 @@
             <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
             <version>2.8.6</version>
         </dependency>
+        <!-- https://mvnrepository.com/artifact/org.jsoup/jsoup -->
+        <dependency>
+            <groupId>org.jsoup</groupId>
+            <artifactId>jsoup</artifactId>
+            <version>1.19.1</version>
+        </dependency>
     </dependencies>
 
     <build>
diff --git a/src/main/java/com/example/demo/config/WebConfig.java b/src/main/java/com/example/demo/config/WebConfig.java
new file mode 100644
index 0000000..eb4e690
--- /dev/null
+++ b/src/main/java/com/example/demo/config/WebConfig.java
@@ -0,0 +1,19 @@
+package com.example.demo.config;
+
+import org.springframework.context.annotation.Configuration;
+import org.springframework.web.servlet.config.annotation.CorsRegistry;
+import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
+
+@Configuration
+public class WebConfig implements WebMvcConfigurer {
+
+    // CORS Configuration
+    @Override
+    public void addCorsMappings(CorsRegistry registry) {
+        registry.addMapping("/**")
+                .allowedOrigins("http://localhost:3000")
+                .allowedHeaders("GET","POST","DELETE","OPTIONS")
+                .allowedHeaders("*")
+                .allowCredentials(true);
+    }
+}
diff --git a/src/main/java/com/example/demo/crawler/NewsDto.java b/src/main/java/com/example/demo/crawler/NewsDto.java
new file mode 100644
index 0000000..674d1aa
--- /dev/null
+++ b/src/main/java/com/example/demo/crawler/NewsDto.java
@@ -0,0 +1,14 @@
+package com.example.demo.crawler;
+
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.NoArgsConstructor;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+public class NewsDto {
+    private String title;
+    private String url;
+//    private String date;
+}
diff --git a/src/main/java/com/example/demo/crawler/YahooNewsCrawler.java b/src/main/java/com/example/demo/crawler/YahooNewsCrawler.java
new file mode 100644
index 0000000..1597d5a
--- /dev/null
+++ b/src/main/java/com/example/demo/crawler/YahooNewsCrawler.java
@@ -0,0 +1,48 @@
+package com.example.demo.crawler;
+
+import org.jsoup.Jsoup;
+import org.jsoup.nodes.Document;
+import org.jsoup.nodes.Element;
+import org.jsoup.select.Elements;
+
+import java.io.IOException;
+import java.time.LocalDate;
+import java.util.ArrayList;
+import java.util.List;
+
+public class YahooNewsCrawler {
+    private static final String NEWS_URL = "https://tw.stock.yahoo.com/quote/2330/news";
+
+    public List<NewsDto> fetchTodayNews() throws IOException {
+        List<NewsDto> results = new ArrayList<>();
+        Document doc = Jsoup.connect(NEWS_URL)
+                .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36")
+                .timeout(10000)
+                .get();
+
+//        System.out.println("頁面結構： "+doc.html());
+
+        Elements items = doc.select("li.js-stream-content");
+        String today = LocalDate.now().toString(); // yyyy-MM-dd
+
+        for (Element item : items) {
+            String title = item.select("h3 a").text();
+            String link = "https://tw.stock.yahoo.com" + item.select("a").attr("href");
+
+
+            System.out.println("=====新聞項目=====");
+            System.out.println(item.html());
+
+//            String date = item.select("time").text();
+
+//            if (date.contains("小時前") || date.contains("分鐘前") || date.contains(today)) {
+//                results.add(new NewsDto(title, link, date));
+//            }
+
+            results.add(new NewsDto(title,link));
+        }
+
+        return results;
+    }
+
+}
diff --git a/src/test/java/com/example/demo/crawler/YahooNewsCrawlerTest.java b/src/test/java/com/example/demo/crawler/YahooNewsCrawlerTest.java
new file mode 100644
index 0000000..4ebf4fb
--- /dev/null
+++ b/src/test/java/com/example/demo/crawler/YahooNewsCrawlerTest.java
@@ -0,0 +1,27 @@
+package com.example.demo.crawler;
+
+import org.junit.jupiter.api.Test;
+
+import java.io.IOException;
+import java.util.List;
+
+import static org.junit.jupiter.api.Assertions.*;
+class YahooNewsCrawlerTest {
+
+    @Test
+    void fetchTodayNews() throws IOException {
+        YahooNewsCrawler crawler = new YahooNewsCrawler();
+
+        // 假設你要測試的股票代號是 "2330.TW"
+        List<NewsDto> newsList = crawler.fetchTodayNews();
+
+        // 檢查抓取到的新聞數量
+        assertTrue(newsList.size() > 0, "新聞列表應該至少有一條新聞");
+
+        // 檢查每條新聞是否包含標題和 URL
+        for (NewsDto news : newsList) {
+            assertNotNull(news.getTitle(), "新聞標題不應該為空");
+            assertNotNull(news.getUrl(), "新聞連結不應該為空");
+        }
+    }
+}
\ No newline at end of file
-- 
2.46.2

